<div class="visitor-container">
  <!-- Header -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()" aria-label="Go back to cocktails">
      ← {{ 'visitor.recipe.backToCocktails' | translate }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <p>{{ 'visitor.recipe.loading' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="goBack()" class="back-link-btn">{{ 'visitor.recipe.goBack' | translate }}</button>
  </div>

  <!-- Recipe Content -->
  <div *ngIf="!loading && !error && cocktail" class="recipe-content">
    <!-- Recipe Header -->
    <div class="recipe-header">
      <h1 class="cocktail-name">{{ cocktail.name }}</h1>
      <div class="badge-group">
        <span class="alcohol-badge" [ngClass]="getAlcoholClass(cocktail.abv)">
          {{ getAlcoholType(cocktail.abv) }}
        </span>
        <span class="abv-badge">{{ cocktail.abv }}% ABV</span>
          <span class="abv-badge base-spirit">{{ cocktail.baseSpirit }}</span>
      </div>
    </div>

    <!-- Substitution Warning -->
    <div *ngIf="usesSubstitutes() || usesAlternatives()" class="substitution-warning">
      <span *ngIf="usesSubstitutes()" class="warning-badge substitute" aria-label="Uses substitute ingredients">
        ⚠️ {{ 'visitor.recipe.usesSubstitutes' | translate }}
      </span>
      <span *ngIf="usesAlternatives()" class="warning-badge alternative" aria-label="Uses alternative ingredients">
        ℹ️ {{ 'visitor.recipe.usesAlternatives' | translate }}
      </span>
    </div>

    <!-- Tags -->
    <div *ngIf="cocktail.tags && cocktail.tags.length > 0" class="info-card">
      <h3 class="section-title">{{ 'visitor.recipe.tags' | translate }}</h3>
      <div class="tags-container">
        <span class="tag" *ngFor="let tag of cocktail.tags">{{ tag }}</span>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="info-card">
      <h3 class="section-title">{{ 'visitor.recipe.ingredients' | translate }}</h3>
      <ul class="ingredients-list">
        <li *ngFor="let item of cocktail.ingredients" 
            class="ingredient-item"
            [class.out-of-stock]="isOutOfStock(item.ingredientId)"
            [class.has-substitute]="getSubstituteInfo(item.ingredientId).hasSubstitute"
            [class.has-alternative]="getSubstituteInfo(item.ingredientId).hasAlternative">
          <div class="ingredient-main">
            <span class="ingredient-measure">{{ formatMeasure(item.measureMl) }}</span>
            <span class="ingredient-name">
              {{ getIngredientName(item.ingredientId) }}
              <span *ngIf="isOutOfStock(item.ingredientId)" class="out-of-stock-indicator">
                ({{ 'visitor.recipe.outOfStock' | translate }})
              </span>
            </span>
          </div>
          <!-- Show substitute info -->
          <div *ngIf="getSubstituteInfo(item.ingredientId).hasSubstitute" 
               class="substitute-info"
               [class.substitute-highlight]="isOutOfStock(item.ingredientId)">
            <span class="substitute-label">
              ⚠️ {{ 'visitor.recipe.substituteWith' | translate }}:
            </span>
            <span class="substitute-names">
              <ng-container *ngFor="let name of getSubstituteInfo(item.ingredientId).substitutes.inStock; let i = index">
                <strong class="in-stock-option">{{ name }}</strong><ng-container *ngIf="i < getSubstituteInfo(item.ingredientId).substitutes.inStock.length - 1 || getSubstituteInfo(item.ingredientId).substitutes.outOfStock.length > 0">, </ng-container>
              </ng-container>
              <ng-container *ngFor="let name of getSubstituteInfo(item.ingredientId).substitutes.outOfStock; let i = index">
                <span class="out-of-stock-sub">{{ name }}</span><ng-container *ngIf="i < getSubstituteInfo(item.ingredientId).substitutes.outOfStock.length - 1">, </ng-container>
              </ng-container>
            </span>
          </div>
          <!-- Show alternative info -->
          <div *ngIf="getSubstituteInfo(item.ingredientId).hasAlternative" 
               class="substitute-info alternative-info"
               [class.substitute-highlight]="isOutOfStock(item.ingredientId)">
            <span class="alternative-label">
              ℹ️ {{ 'visitor.recipe.alternativeWith' | translate }}:
            </span>
            <span class="substitute-names">
              <ng-container *ngFor="let name of getSubstituteInfo(item.ingredientId).alternatives.inStock; let i = index">
                <strong class="in-stock-option">{{ name }}</strong><ng-container *ngIf="i < getSubstituteInfo(item.ingredientId).alternatives.inStock.length - 1 || getSubstituteInfo(item.ingredientId).alternatives.outOfStock.length > 0">, </ng-container>
              </ng-container>
              <ng-container *ngFor="let name of getSubstituteInfo(item.ingredientId).alternatives.outOfStock; let i = index">
                <span class="out-of-stock-sub">{{ name }}</span><ng-container *ngIf="i < getSubstituteInfo(item.ingredientId).alternatives.outOfStock.length - 1">, </ng-container>
              </ng-container>
            </span>
          </div>
        </li>
      </ul>
    </div>

    <!-- Instructions -->
    <div class="info-card">
      <h3 class="section-title">{{ 'visitor.recipe.instructions' | translate }}</h3>
      <ol class="steps-list">
        <li *ngFor="let step of cocktail.steps; let i = index" class="step-item">
          <span class="step-number">{{ i + 1 }}</span>
          <span class="step-text">{{ step }}</span>
        </li>
      </ol>
    </div>

    <!-- Notes -->
    <div *ngIf="cocktail.notes" class="info-card notes-card">
      <h3 class="section-title">{{ 'visitor.recipe.notes' | translate }}</h3>
      <p class="notes-text">{{ cocktail.notes }}</p>
    </div>
  </div>
</div>
