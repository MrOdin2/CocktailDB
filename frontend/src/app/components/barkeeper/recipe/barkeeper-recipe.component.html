<div class="barkeeper-container">
  <!-- Header -->
    <div class="view-header">
        <button class="back-btn" (click)="goBack()">← {{ 'common.back' | translate }}</button>
        <h2>{{ cocktail?.name || ('barkeeper.recipe.title' | translate) }}</h2>
        <div class="info-badge">
            <span class="info-value"> {{ 'barkeeper.recipe.base' | translate }} {{ cocktail?.baseSpirit | titlecase }}</span>
            <span class="info-value"> {{ 'barkeeper.recipe.abv' | translate }} {{ cocktail?.abv }}%</span>
        </div>
    </div>

  <div *ngIf="isLoading" class="loading">{{ 'common.loading' | translate }}</div>

  <!-- Recipe Content -->
  <div *ngIf="!isLoading && cocktail" class="recipe-content">
    <!-- Substitution Warning -->
    <div *ngIf="usesSubstitutes() || usesAlternatives()" class="substitution-warning">
      <span
        *ngIf="usesSubstitutes()"
        class="warning-badge substitute"
        aria-label="⚠️ {{ 'barkeeper.recipe.usesSubstitutes' | translate }}"
      >
        ⚠️ {{ 'barkeeper.recipe.usesSubstitutes' | translate }}
      </span>
      <span
        *ngIf="usesAlternatives()"
        class="warning-badge alternative"
        aria-label="ℹ️ {{ 'barkeeper.recipe.usesAlternatives' | translate }}"
      >
        ℹ️ {{ 'barkeeper.recipe.usesAlternatives' | translate }}
      </span>
    </div>

      <div class="important-section">
          <div class="recipe-section">
              <h3>{{ 'barkeeper.recipe.ingredients' | translate }}</h3>
              <ul class="ingredients-list-recipe">
                  <li *ngFor="let ing of cocktail.ingredients" 
                      [class.out-of-stock]="isOutOfStock(ing.ingredientId)"
                      [class.has-substitute]="getSubstituteInfo(ing.ingredientId).substitutes.inStock.length > 0 || getSubstituteInfo(ing.ingredientId).substitutes.outOfStock.length > 0"
                      [class.has-alternative]="getSubstituteInfo(ing.ingredientId).alternatives.inStock.length > 0 || getSubstituteInfo(ing.ingredientId).alternatives.outOfStock.length > 0">
                      <div>
                        <span class="measure">{{ formatMeasure(ing.measureMl) }}</span>
                        <span class="name">
                          {{ getIngredientName(ing.ingredientId) }}
                          <span *ngIf="isOutOfStock(ing.ingredientId)" class="out-of-stock-indicator">
                            ({{ 'barkeeper.recipe.outOfStock' | translate }})
                          </span>
                        </span>
                      </div>
                      <!-- Show substitute info -->
                      <div *ngIf="getSubstituteInfo(ing.ingredientId).substitutes.inStock.length > 0 || getSubstituteInfo(ing.ingredientId).substitutes.outOfStock.length > 0" 
                           class="substitute-info"
                           [class.substitute-highlight]="isOutOfStock(ing.ingredientId)">
                        <span class="substitute-label">
                          ⚠️ {{ 'barkeeper.recipe.substituteWith' | translate }}:
                        </span>
                        <span class="substitute-names">
                          <ng-container *ngFor="let name of getSubstituteInfo(ing.ingredientId).substitutes.inStock; let i = index">
                            <strong class="in-stock-option">{{ name }}</strong><ng-container *ngIf="i < getSubstituteInfo(ing.ingredientId).substitutes.inStock.length - 1 || getSubstituteInfo(ing.ingredientId).substitutes.outOfStock.length > 0">, </ng-container>
                          </ng-container>
                          <ng-container *ngFor="let name of getSubstituteInfo(ing.ingredientId).substitutes.outOfStock; let i = index">
                            <span class="out-of-stock-sub">{{ name }}</span><ng-container *ngIf="i < getSubstituteInfo(ing.ingredientId).substitutes.outOfStock.length - 1">, </ng-container>
                          </ng-container>
                        </span>
                      </div>
                      <!-- Show alternative info -->
                      <div *ngIf="getSubstituteInfo(ing.ingredientId).alternatives.inStock.length > 0 || getSubstituteInfo(ing.ingredientId).alternatives.outOfStock.length > 0" 
                           class="substitute-info alternative-info"
                           [class.substitute-highlight]="isOutOfStock(ing.ingredientId)">
                        <span class="alternative-label">
                          ℹ️ {{ 'barkeeper.recipe.alternativeWith' | translate }}:
                        </span>
                        <span class="substitute-names">
                          <ng-container *ngFor="let name of getSubstituteInfo(ing.ingredientId).alternatives.inStock; let i = index">
                            <strong class="in-stock-option">{{ name }}</strong><ng-container *ngIf="i < getSubstituteInfo(ing.ingredientId).alternatives.inStock.length - 1 || getSubstituteInfo(ing.ingredientId).alternatives.outOfStock.length > 0">, </ng-container>
                          </ng-container>
                          <ng-container *ngFor="let name of getSubstituteInfo(ing.ingredientId).alternatives.outOfStock; let i = index">
                            <span class="out-of-stock-sub">{{ name }}</span><ng-container *ngIf="i < getSubstituteInfo(ing.ingredientId).alternatives.outOfStock.length - 1">, </ng-container>
                          </ng-container>
                        </span>
                      </div>
                  </li>
              </ul>
          </div>

          <!-- Instructions Section -->
          <div class="recipe-section">
              <h3>{{ 'barkeeper.recipe.instructions' | translate }}</h3>
              <ol class="steps-list">
                  <li *ngFor="let step of cocktail.steps">{{ step }}</li>
              </ol>
          </div>
      </div>

    <!-- Notes Section -->
    <div *ngIf="cocktail.notes" class="recipe-section">
      <h3>{{ 'barkeeper.recipe.notes' | translate }}</h3>
      <p class="notes">{{ cocktail.notes }}</p>
    </div>

    <!-- Tags Section -->
    <div *ngIf="cocktail.tags && cocktail.tags.length > 0" class="recipe-section">
      <h3>{{ 'barkeeper.recipe.tags' | translate }}</h3>
      <div class="tags-list">
        <span *ngFor="let tag of cocktail.tags" class="tag">{{ tag }}</span>
      </div>
    </div>
  </div>
</div>
